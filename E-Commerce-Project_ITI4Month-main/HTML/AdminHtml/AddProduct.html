<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Add New Product</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <style>
        body {
            background-color: #f8f9fa;
            font-family: Inter, system-ui, sans-serif;
        }

        /*  Unified inputs style */
        .form-control,
        .form-select {
            height: 56px;
            border-radius: 12px;
        }

        .form-control:focus,
        .form-select:focus {
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, .15);
        }

        .upload-zone {
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 2.5rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            background: #fff;
        }

        .upload-zone:hover {
            border-color: #0d6efd;
            background: #f8f9ff;
        }

        .preview-img {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <main class="container py-5">
        <div class="col-lg-10 mx-auto">
            <h1 class="fw-bold mb-4">Add New Product</h1>

            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body p-5">
                    <form id="productForm" novalidate>

                        <!-- Name + Category -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Product Name </label>
                                <input type="text" id="productName" class="form-control form-control-lg"
                                    placeholder="e.g. Wireless Headphones">
                                <div class="invalid-feedback">Product name is required</div>
                            </div>

                            <div class="col-md-6">
                                 <label class="form-label fw-semibold" for="category">Category</label>
                                <select class="form-select form-select-lg" id="category">
                                    <option disabled="" selected="" value="">Select a category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="apparel">Apparel</option>

                                </select>
                            </div>
                        </div>
                </div>

                <!-- Price + Stock -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-semibold" for="price">Price ($) <span
                                class="text-danger">*</span></label>
                        <div class="input-group has-validation">
                            <input class="form-control form-control-lg is-invalid" id="price" type="text"
                                 />
                            <span class="input-group-text text-danger border-danger bg-danger bg-opacity-10">
                                <span class="material-symbols-outlined">warning</span>
                            </span>
                            <div class="invalid-feedback">
                                Price must be a positive number
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Stock</label>
                        <input type="number" id="stock" class="form-control form-control-lg" value="0">
                    </div>
                </div>

                <!-- Image -->
                <div class="mb-4">
                    <label class="form-label fw-semibold">Product Image *</label>
                    <div class="upload-zone" id="uploadZone">
                        <span class="material-symbols-outlined fs-1">cloud_upload</span>
                        <p class="mb-0">Click to upload image</p>
                        <input type="file" id="imageInput" accept="image/*" hidden>
                        <img id="preview" class="preview-img d-none">
                    </div>
                    <div class="invalid-feedback d-block d-none" id="imageError">
                        Image is required
                    </div>
                </div>

                <!-- Description -->
                <div class="mb-4">
                    <label class="form-label fw-semibold">Description</label>
                    <textarea id="description" class="form-control" rows="4"></textarea>
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-end gap-3">
                    <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                    <button type="submit" id="saveBtn" class="btn btn-primary" disabled>
                        Save Product
                    </button>
                </div>

                </form>
            </div>
        </div>
        </div>
    </main>

    <script>
        const form = document.getElementById("productForm");
        const saveBtn = document.getElementById("saveBtn");

        const nameInput = productName;
        const priceInput = price;
        const categorySelect = category;
        const imageInput = document.getElementById("imageInput");
        const preview = document.getElementById("preview");
        const imageError = document.getElementById("imageError");

        let imageBase64 = "";

        // Load categories
        const categories = JSON.parse(localStorage.getItem("categories")) || [];
        categories.forEach(c => {
            categorySelect.innerHTML += `<option value="${c.name}">${c.name}</option>`;
        });

        // Image upload
        uploadZone.onclick = () => imageInput.click();

        imageInput.onchange = () => {
            const file = imageInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = e => {
                imageBase64 = e.target.result;
                preview.src = imageBase64;
                preview.classList.remove("d-none");
                imageError.classList.add("d-none");
                validateForm();
            };
            reader.readAsDataURL(file);
        };

        // Validation
        function validateInput(input, condition) {
            if (!condition) {
                input.classList.add("is-invalid");
                return false;
            }
            input.classList.remove("is-invalid");
            return true;
        }

        function validateForm() {
            const valid =
                validateInput(nameInput, nameInput.value.trim()) &
                validateInput(priceInput, priceInput.value > 0) &
                validateInput(categorySelect, categorySelect.value) &
                (imageBase64 !== "");

            imageError.classList.toggle("d-none", imageBase64 !== "");
            saveBtn.disabled = !valid;
        }

        [nameInput, priceInput, categorySelect].forEach(el =>
            el.addEventListener("input", validateForm)
        );

        // Save product
        form.onsubmit = e => {
            e.preventDefault();

            const products = JSON.parse(localStorage.getItem("products")) || [];

            products.push({
                id: Date.now(),
                title: nameInput.value,
                price: priceInput.value,
                stock: stock.value,
                category: categorySelect.value,
                description: description.value,
                img: imageBase64
            });

            localStorage.setItem("products", JSON.stringify(products));
            alert("Product saved successfully ✔️");
            form.reset();
            preview.classList.add("d-none");
            imageBase64 = "";
            saveBtn.disabled = true;
           window.location.href = "../index.html";
        };
    </script>

</body>

</html>