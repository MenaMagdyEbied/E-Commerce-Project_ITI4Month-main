<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title>Product Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: #fff;
        }

        main { flex: 1; padding: 50px 0; }

        .btn-primary {
            background-color: #0d6efd !important;
            border: none !important;
            transition: 0.3s;
        }

        .btn-outline-danger {
            border: 1px solid #ddd !important;
            color: #636e72 !important;
            transition: 0.3s;
        }

        .btn-outline-danger:not(.active):hover {
            background-color: #0d6efd !important;
            color: white !important;
            border-color: #0d6efd !important;
        }

        .btn-outline-danger.active {
            background-color: #dc3545 !important;
            color: white !important;
            border-color: #dc3545 !important;
        }
    </style>
</head>

<body>
    <div id="navbar"></div>
    <main>
        <div class="container py-5">
            <div class="row g-5 align-items-center">
                <div class="col-md-6 text-center">
                    <img id="p-img" src="" class="img-fluid rounded-4 shadow-sm" style="max-height: 450px; object-fit: contain;">
                </div>
                <div class="col-md-6">
                    <a href="index.html" class="btn btn-sm btn-outline-primary mb-3"><i class="bi bi-arrow-left"></i> Back to Shop</a>
                    <h1 id="p-title" class="fw-bold mb-3"></h1>
                    <div id="star-container" class="mb-3"></div>
                    <h3 id="p-price" class="text-primary fw-bold mb-4"></h3>
                    <p class="text-muted lh-lg mb-5">High-performance product with premium features and stylish design.</p>
                    
                    <div class="d-flex gap-3">
                        <button class="btn btn-primary btn-lg flex-grow-1 rounded-pill shadow" 
                                onclick="addToCart(productData.title, productData.price, productData.img)">
                            Add to Cart
                        </button>
                        
                        <button id="wishBtn" class="btn btn-outline-danger rounded-pill px-4"
                                onclick="addToWishlist(productData.title, productData.price, productData.img); syncWishUI();">
                            <i id="wishIcon" class="bi bi-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div id="footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        
        // وحدنا المسمى هنا  title عشان يبقى زي الهاندلر
        const productData = {
            id: parseInt(params.get('id')),
            title: params.get('name'), 
            price: params.get('price'),
            img: decodeURIComponent(params.get('img')),
            rating: params.get('rating')
        };

        if (productData.title) {
            document.getElementById('p-title').innerText = productData.title;
            document.getElementById('p-price').innerText = "$" + productData.price;
            document.getElementById('p-img').src = productData.img;
            displayStars(productData.rating);
            
            // بيشيك أول ما الصفحة تفتح لو متسيف في ال Index
            checkWishStatus(); 
        }

        function displayStars(rating) {
            let html = `<span class="fw-bold me-2">${rating}</span>`;
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) html += '<i class="bi bi-star-fill text-warning"></i>';
                else if (i === Math.ceil(rating) && rating % 1 >= 0.5) html += '<i class="bi bi-star-half text-warning"></i>';
                else html += '<i class="bi bi-star text-warning"></i>';
            }
            document.getElementById('star-container').innerHTML = html;
        }

        function checkWishStatus() {
            const wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            const btn = document.getElementById('wishBtn');
            const icon = document.getElementById('wishIcon');
            
            if (!btn || !icon) return;

            // بنقارن بال title اللي متخزن في الهاندلر المركزي
            const isFavourite = wishlist.some(item => {
                const storedTitle = item.title || item.name; 
                return storedTitle && storedTitle.trim() === productData.title.trim();
            });

            if (isFavourite) {
                btn.classList.add('active');
                icon.classList.replace('bi-heart', 'bi-heart-fill');
            } else {
                btn.classList.remove('active');
                icon.classList.replace('bi-heart-fill', 'bi-heart');
            }
        }

        function syncWishUI() {
            //  بسيطة عشان نضمن إن الهاندلر خلص كتابة في  Storage
            setTimeout(checkWishStatus, 200); 
        }
    </script>
    <script src="../JAVASCRIPT/authhelper.js"></script>
    <script src="../JAVASCRIPT/LoadComponents.js"></script>
</body>
</html>