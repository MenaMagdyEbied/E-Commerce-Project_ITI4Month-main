<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title>Product Details</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }

        main {
            flex: 1;
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .navbar-custom {
            background-color: white;
            border-bottom: 1px solid #eee;
        }

        .back-link-blue {
            color: #0d6efd;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            transition: 0.3s;
        }

        .back-link-blue:hover {
            color: #0056b3;
            text-decoration: underline;
        }
    </style>
</head>

<body>

    <nav id="navbar"></nav>

    <main class="d-flex align-items-center">
        <div class="container py-5">
            <div class="row g-5 align-items-center">
                <div class="col-md-6 text-center">
                    <img id="p-img" src="" class="img-fluid rounded-4 shadow-sm"
                        style="max-height: 450px; width: 100%; object-fit: cover;">
                </div>
                <div class="col-md-6 text-start">
                    <a href="index.html" class="back-link-blue">
                        <i class="bi bi-arrow-left"></i> Back to Store
                    </a>

                    <h1 id="p-title" class="fw-bold mb-3"></h1>
                    <p class="h5 mb-3">
                        <span id="p-rating-val" class="fw-bold me-2"></span>
                        <span class="text-warning" id="p-stars"></span>
                        <span class="text-muted fs-6 ms-2">(150 reviews)</span>
                    </p>
                    <h3 id="p-price" class="text-primary fw-bold mb-4"></h3>
                    <p class="text-muted lh-lg mb-5">
                        This product represents the latest in technology, combining elegant
                        design with powerful performance to meet your expectations.
                    </p>
                    <div class="d-flex gap-3">
                        <button id="addCartBtn" class="btn btn-primary btn-lg flex-grow-1 rounded-pill shadow">
                            Add to Cart
                        </button>
                        <button id="addWishBtn" class="btn btn-outline-danger rounded-pill px-4">
                            <i class="bi bi-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer id="footer"></footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../JAVASCRIPT/LoadComponents.js"></script>
    <script src="../JAVASCRIPT/auth.js"></script>
    <script src="../JAVASCRIPT/script.js"></script>

    <script>
        const params = new URLSearchParams(window.location.search);

        const product = {
            name: params.get('name') || "Product Name",
            price: parseFloat(params.get('price')) || 0,
            img: decodeURIComponent(params.get('img') || "download.jpg"),
            rating: parseFloat(params.get('rating')) || 4.5
        };

        document.getElementById('p-title').innerText = product.name;
        document.getElementById('p-price').innerText = product.price.toFixed(2) + " EGP";
        document.getElementById('p-img').src = product.img;
        document.getElementById('p-rating-val').innerText = product.rating;
        document.getElementById('p-stars').innerHTML = getStars(product.rating);

        // دالة إنشاء النجوم
        function getStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) stars += '<i class="bi bi-star-fill text-warning"></i>';
                else if (i === Math.ceil(rating) && rating % 1 >= 0.5) stars += '<i class="bi bi-star-half text-warning"></i>';
                else stars += '<i class="bi bi-star text-warning"></i>';
            }
            return stars;
        }

        // إضافة للـ cart
        document.getElementById('addCartBtn').addEventListener('click', () => {
            addToCart(product.name, product.price, product.img);
        });

        // إضافة/إزالة من الـ wishlist مع تغيير أيقونة القلب
        const wishBtn = document.getElementById('addWishBtn');
        function updateWishIcon() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const inWishlist = user && user.wishlist && user.wishlist.some(item => item.title === product.name);
            const icon = wishBtn.querySelector('i');
            if (inWishlist) {
                wishBtn.classList.add('btn-danger');
                wishBtn.classList.remove('btn-outline-danger');
                icon.classList.add('bi-heart-fill', 'text-white');
                icon.classList.remove('bi-heart');
            } else {
                wishBtn.classList.add('btn-outline-danger');
                wishBtn.classList.remove('btn-danger');
                icon.classList.add('bi-heart');
                icon.classList.remove('bi-heart-fill', 'text-white');
            }
        }

        wishBtn.addEventListener('click', () => {
            addToWishlist(product.name, product.price, product.img);
            updateWishIcon();
        });

        // تحديث أيقونة القلب عند تحميل الصفحة
        updateWishIcon();
    </script>

</body>

</html>
